# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Site purpose

This is the **unified documentation and marketing site for the entire `@libar-dev/` ecosystem** — a suite of TypeScript packages for context engineering, AI-assisted codebases, and Convex/Zod infrastructure. The site is designed to grow as packages are published; `delivery-process` is the first package with docs here.

**Known packages to add docs for** (not yet integrated):
- **`@libar-dev/zod-convex-*`** (7 packages: `zod-convex-core`, `zod-convex-ids`, `zod-convex-tables`, `zod-convex-codecs`, `zod-convex-gen`, `zod-convex-builders`, `eslint-plugin-zod-convex`) — Zod-to-Convex bridge with build-time code generation. Source: `github.com/libar-dev/zod-convex-packages`
- **`libar-platform`** — Source: `github.com/libar-dev/libar-platform`

**Landing page status**: Currently only a minimal Hero section is live. The original design prototype (at `../delivery-process/_designs/unified/index.html` locally, Swiss Constructivist) included additional sections still to be ported: Pipeline, Capabilities, Comparison, and QuickStart. The design tokens and visual language are already implemented in `src/styles/tokens.css`.

## Commands

```bash
pnpm dev          # sync content then start Astro dev server (localhost:4321/website/)
pnpm build        # sync content (prebuild) then build for production
pnpm preview      # preview production build
pnpm sync         # run content sync only (scripts/sync-content.mjs)
node scripts/sync-content.mjs --verbose  # sync with per-file logging
```

Package manager: **pnpm**. There are no tests; this is a documentation site.

## Architecture

This is a **three-layer content site** built on Astro 5.6 + Starlight 0.37:

### Layer 1 — Hand-crafted (committed to git)
- `src/pages/index.astro` — Landing page (outside Starlight, uses custom layout/components)
- `src/content/docs/delivery-process/index.mdx` — Package overview
- `src/content/docs/delivery-process/getting-started.md` — Quick start

### Layer 2 — Synced at build time (git-ignored, reproducible)
Everything under `src/content/docs/delivery-process/` **except** the files above is generated by `scripts/sync-content.mjs`. The script:
- Copies markdown from sibling repos (`../delivery-process/` and `../dp-mini-demo/`)
- Strips H1 headings, injects Starlight frontmatter (title, sidebar order, editUrl)
- Rewrites relative inter-doc links to absolute site paths
- Splits a single tutorial article into numbered part files

**Local dev** expects sibling repos at `../delivery-process/` and `../dp-mini-demo/`.
**CI** checks them out at `./delivery-process/` and `./dp-mini-demo/` (same directory).

### Layer 3 — Build artifacts (git-ignored)
Pagefind search index, rendered Mermaid SVGs, `dist/`.

## Key configuration files

- `astro.config.mjs` — `base: '/website'` (GitHub Pages path); `mermaid()` integration **must be listed before** `starlight()` or diagram fences won't process; sidebar groups map 1:1 to subdirectories under `src/content/docs/delivery-process/`
- `src/styles/tokens.css` — Design tokens using `--dp-*` prefix (Swiss Constructivist, accent `#e8530e`); mapped to `--sl-*` in `starlight-overrides.css`
- `src/styles/landing.css` — Styles for the custom landing page only
- `src/content.config.ts` — Starlight content collection config

## Extending to new packages

To add a new package's docs (e.g. `zod-convex-packages`):
1. Add a source entry in `scripts/sync-content.mjs` `SOURCES` object
2. Add sync function(s) mirroring the existing pattern
3. Add a new `src/content/docs/<package-name>/` directory with at minimum an `index.mdx`
4. Add a sidebar group in `astro.config.mjs`
5. Add the repo checkout to `.github/workflows/deploy.yml`

## Deployment

GitHub Actions (`.github/workflows/deploy.yml`) deploys to GitHub Pages on push to `main`. It checks out `libar-dev/delivery-process` at tag `v1.0.0-pre.0` and `libar-dev/dp-mini-demo` as siblings, then runs `pnpm build` (which triggers `prebuild` → sync → Astro build).

To switch to custom domain `libar.dev`: add `public/CNAME`, update `astro.config.mjs` (`site: 'https://libar.dev'`, remove `base`), configure DNS, enable HTTPS in GitHub Pages settings.

## Theme system

The landing page and Starlight docs share a single theme. Theme toggle on the landing page writes to `localStorage('starlight-theme')` so Starlight picks it up. The `data-theme` attribute on `<html>` drives both `--dp-*` token overrides and Starlight's built-in dark mode.
